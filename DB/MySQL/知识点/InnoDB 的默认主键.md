> 转摘：[InnoDB的自增键和row_id用完了会发生什么？](https://mp.weixin.qq.com/s/2g_tliP38SinjbwQvjMg-w)

在 InnoDB 引擎中创建表时，如果没有显式地创建主键，那么存储引擎会按照如下的步骤为该表设置主键：

1. 从该表中找一个具有`NOT NULL`属性的、值唯一的二级索引列来充当主键；
2. 如果没有找到，则会默认的为该表添加一个称之为`row_id`的主键列，该列为 6 个字节大小。

需要注意的是：InnoDB 并不是为每一个未显式创建主键的表的`row_id`列都单独维护一个计数器，而是所有的表都共享一个全局的计数器。

比如，如果没有对表`t1`和`t2`显式创建主键，存储引擎会为他们都创建一个`row_id`列，而且这两个表的`row_id`使用的同一个计数器。当向表`t1`中插入一条记录时，就会从全局计数器里分配一个值做该表的`row_id`列的值，然后将全局计数器加 1；再向表`t2`中插入一条记录，那么就再从全局计数器里分配一个值作为该表的`row_id`列的值，然后将全局计数器加 1。

当全局计数器的值达到六个字节所能存储的最大值时，再新增数据的时候，就会让 MySQL 直接挂掉。也就说，全局计数器达到 6 字节的最大值时会引起 MySQL 挂掉。



