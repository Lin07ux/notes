> 参考：
> 
> 1. [SQL执行顺序-以MySQL为例](https://zhuanlan.zhihu.com/p/532115107)
> 2. [深入理解MySQL执行过程及执行顺序](https://dockone.io/article/2434613)

## 一、基础

SQL 的执行顺序并不是按照书写的顺序来从前往后、从左往右依次执行的，而是按照固定的顺序解析和执行的。主要的作用就是从上一个阶段的执行返回结果提供给下一阶段使用，而在不同的执行过程中会有不同的临时中间表产生。

MySQL 的执行过程基本按照 SQL 执行顺序来实现，但是也并非完全一致，MySQL 会有一些优化操作来提升 SQL 语句的执行过程，优化查询效果，从而导致其实际的执行流程可能发生变化。

### 1.1 顺序图

SQL 的一般执行顺序如下图所示：

![](https://cnd.qiniu.lin07ux.cn/markdown/1669773055)

### 1.2 详细说明

**FROM**

第一步就是选择出 FROM 关键词后面的表，表示要从数据库中的哪张表中进行操作，如果有多张表就逐步的对其进行两表使用笛卡尔积生成中间表 Temp1。

**JOIN ON**

JOIN 表示要关联的表，ON 是连接的条件。

通过 FROM 和 JOIN 选择出需要执行的数据库表，产生笛卡尔积，生成中间表，然后使用 ON 中的条件过滤中间表中的数据，得到符合条件的中间表 Temp2。

**WHERE**

WHERE 表示筛选，根据其后面的条件对上一步中得到的中间表进行过滤，按照指定的字段值（如果有 AND 连接符会进行联合筛选）从中筛选出符合条件的数据，生成中间表 Temp3。

如果在此阶段找不到数据，会直接返回给客户端，不会继续往下执行。而且，在 WHERE 中不能使用聚合函数。

**GROUP BY**

对 Temp3 中的数据按照指定的字段的值进行分组，产生临时中间表 Temp4。

在这个过程中，只是数据的顺序发生改变，数据总量不会发生变化。分组之后，表中的数据以组的形式存在。

**HAVING**

对 Temp4 进行条件过滤，用符合条件的数据生成临时中间表 Temp5。

在这个阶段中可以执行聚合函数，比如`count/sum/avg`等，而且在这个阶段中就可以使用 SELECT 中的别名。

**SELECT**

从 Temp5 中挑选出需要查询的数据，并将`*`解析为所有的数据列，生成临时中间表 Temp6。

**DISTINCT**

对所有的数据进行去重，如果有`min/max`函数，会执行字段函数的计算，然后生成临时中间表 Temp7。

**ORDER BY**

对 Temp7 中的数据进行排序（升序、降序），生成临时中间表 Temp8。

这个过程比较耗费资源，而且如果数据量比多的话，还会使用到文件排序，就会更加费时了。

**LIMIT**

对 Temp8 进行分页，并取出其中需要的分页的数据，产生临时中间表 Temp9，发回给客户端。

