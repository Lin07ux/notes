### 1. 表结构定义中字段类型后的数值的作用

**问**：MySQL 中，设置了数值的宽度，是否会影响数值的取值范围。

**答**：不会。

显示宽度和数据类型的取值范围是无关的。显示宽度只是指明 MYSQL 最大可能显示的数字个数，数值的位数小于指定的宽度时会有空格填充。**如果插入了大于显示宽度的值，只要该值不超过该类型整数的取值范围，数值依然可以插入，而且能显示出来**。如果不指定显示宽度，则 MYSQL 为每一种类型指定默认的宽度值。

例如，创建一个 year 字段，并设置为 int(4) 类型。当向 year 字段插入数值 19999 后，使用 select 查询的时候，MYSQL 显示的将是完整带有 5 位数字的 19999，而不是 4 位数字的值。

**显示宽度只用于显示，并不能限制取值范围和占用空间，例如：INT(3) 会占用 4 个字节的存储空间，并且允许的最大值也不会是 999，而是 INT 整型所允许的最大值。**

### 2. localhost 和 127.0.0.1 的区别

* `localhot(local)` 不使用 TCP/IP 连接，而使用 Unix socket，它不受网络防火墙和网卡相关的的限制。
* `127.0.0.1` 通过网卡传输，使用 TCP/IP 连接，依赖网卡，并受到网络防火墙和网卡相关的限制。

一般设置程序时本地服务用`localhost`是最好的，`localhost`不会解析成 IP，也不会占用网卡、网络资源。有时候用`localhost`可以链接，但用`127.0.0.1`不可以的情况原因就是在于此。

使用`localhost`访问时，系统带着本机当前用户的权限去访问，而用 IP 的时候，等于本机是通过网络再去访问本机，可能涉及到网络用户的权限问题。

> PHP 中使用`localhost`的时候需要注意，一般应该配置`php.ini`文件中的数据库的 socket 配置，或者对特定的项目配置 DB SOCKET。
> 
> 比如，使用 MySQL 数据库时，应该配置`pdo_mysql.default_socket`，否则会出现`SQLSTATE[HY000] [2002] No such file or directory`，这是由于 PHP 无法正确找到 MySQL 的 socket 文件而无法连接数据库。
> 
> 对于非编译安装的 PHP 和 MySQL，一般无需配置`pdo_mysql.default_socket`，它们会自动找到相关服务。

### 3. 大小写规则

MySQL 在 Linux 下数据库名、表名、字段(列)名、别名、内容大小写规则是这样的：

1. 数据库名与表名是严格区分大小写的；
2. 表的别名是严格区分大小写的；
3. 列名与列的别名在所有的情况下均是忽略大小写的；
4. 字段内容默认情况下是大小写不敏感的。

字段值的大小写由 MySQL 的校对规则来控制。字符集是一套符号和编码，校对规则是在字符集内用于比较字符的一套规则。一般而言，校对规则以其相关的字符集名开始，通常会包含一个语言名，并且以`ci`(大小写不敏感)、`cs`(大小写敏感)或`bin`(二进制)结束。

比如对于 utf8 字符集，其校对规则如下：

* `utf8_bin` 将字符串中的每一个字符用二进制数据存储，区分大小写。
* `utf8_general_ci` 不区分大小写，`ci`为 case insensitive 的缩写，即大小写不敏感。
* `utf8_general_cs` 区分大小写，`cs`为 case sensitive 的缩写，即大小写敏感。

通常情况下，MySQL 会使用`utf8_general_ci`或者`utf8mb4_general_ci`校对规则创建表，而字段默认会继承表的校对规则，所以字段内容在查询时就是大小写不敏感了。

如果需要字段内容是大小写敏感的，可以将字段或表的校对规则改成当前字符集的`cs`或`bin`校对规则。如果只是临时查询需要，可以考虑使用`BINARY`关键词，如下：

```sql
select * from tb_user where BINARY username ='user';
```

### 4. 默认主键

> 转摘：[InnoDB的自增键和row_id用完了会发生什么？](https://mp.weixin.qq.com/s/2g_tliP38SinjbwQvjMg-w)

在 InnoDB 引擎中创建表时，如果没有显式地创建主键，那么存储引擎会按照如下的步骤为该表设置主键：

1. 从该表中找一个具有`NOT NULL`属性的、值唯一的二级索引列来充当主键；
2. 如果没有找到，则会默认的为该表添加一个称之为`row_id`的主键列，该列为 6 个字节大小。

需要注意的是：InnoDB 并不是为每一个未显式创建主键的表的`row_id`列都单独维护一个计数器，而是所有的表都共享一个全局的计数器。

比如，如果没有对表`t1`和`t2`显式创建主键，存储引擎会为他们都创建一个`row_id`列，而且这两个表的`row_id`使用的同一个计数器。当向表`t1`中插入一条记录时，就会从全局计数器里分配一个值做该表的`row_id`列的值，然后将全局计数器加 1；再向表`t2`中插入一条记录，那么就再从全局计数器里分配一个值作为该表的`row_id`列的值，然后将全局计数器加 1。

**当全局计数器的值达到六个字节所能存储的最大值时，再新增数据的时候，就会让 MySQL 直接挂掉**。也就说，全局计数器**达到 6 字节**的最大值时会引起 MySQL 挂掉。

### 5. 自增 ID 的记录方式

不同类型的存储引擎记录最大 ID 记录的方式不同：

* MyISAM 将最大的 ID 记录到了数据文件里，重启 MySQL 后自增主键的最大 ID 值不会丢失；
* InnoDB 将最大的 ID 值记录到了内存中，重启 MySQL 或者对表进行了`OPTIMIZE`操作后，最大 ID 值将会丢失。

所以，如果有一张表，里面有个字段为`id`的自增主键，当已经向表里面插入了 10 条数据之后，删除了`id`为 8、9、10 的数据，再把 MySQL 重启。重启之后再插入一条数据，那么这条数据的`id`值在 MyISAM 存储引擎表中为 11，在 InnoDB 存储引擎表中则为 8。

MYSQL 获取当前表的自增值的四种方法：

1. `SELECT MAX(id) FROM <table_name>` 针对特定表；
2. `SELECT LAST_INSERT_ID()` 针对任何表；
3. `SELECT @@identity` 针对任何表；
4. `SHOW TABLE STATUS LIKE '<table_name>'`  如果针对特定表，建议使用这一种方法。得出的结果里边对应表名记录中有个 Auto_increment 字段，里边有下一个自增 ID 的数值就是当前该表的最大自增 ID。

> `@@identity`是表示的是最近一次向具有`identity`属性(即自增列)的表插入数据时对应的自增列的值，是系统定义的全局变量。使用`@@identity`的前提是在进行`insert`操作后，执行`select @@identity`的时候连接没有关闭，否则得到的将是`NULL(0)`值。
> 
> 一般系统定义的全局变量都是以`@@`开头，用户自定义变量以`@`开头。


