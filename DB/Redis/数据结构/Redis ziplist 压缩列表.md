压缩列表(ziplist)是 list 和 hash 的底层实现之一。如果 list 的每个都是小整数值，或者是比较短的字符串，压缩列表(ziplist)就会作为 list 的底层实现。

压缩列表(ziplist)是 Redis 为了节约内存而开发的，是由一系列的特殊编码的连续内存块组成的顺序性数据结构。

### 1. 列表结构

压缩列表结构图例如下：

![](http://cnd.qiniu.lin07ux.cn/markdown/1558873859484.png)

属性值有：

* `zlbytes`: 长度为 4 字节，记录整个压缩数组的内存字节数。
* `zltail`: 长度为 4 字节，记录压缩队列表尾节点距离压缩队列的起始地址有多少字节，通过该属性可以直接确定尾节点的地址。
* `zllen`: 长度为 2 字节，包含的节点数。当属性值小于 INT16_MAX 时，该值就是节点总数，否则需要遍历整个队列才能确定总数。
* `zlend`: 长度为 1 字节，特殊值，用于标记压缩队列的末端。

**压缩列表从表尾节点倒序遍历**，首先指针通过`zltail`偏移量指向表尾节点，然后通过指向节点记录的前一个节点的长度依次向前遍历访问整个压缩列表。

### 2. 节点结构

压缩列表中，每个节点的结构图如下：

![](http://cnd.qiniu.lin07ux.cn/markdown/1558873910012.png)

属性值有：

* `previous_entry_length`: 压缩列表中前一个节点的长度，和当前的地址进行指针运算，计算出前一个节点的起始地址。
* `encoding`: 节点保存数据的类型和长度
* `content`: 节点值，可以为一个字节数组或者整数。

