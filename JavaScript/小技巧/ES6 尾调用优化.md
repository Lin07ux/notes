JavaScript 中，程序运行到一个函数，它就会将其添加到调用栈中，成为一个调用帧。当从这个函数返回的时候，就会将这个调用帧从调用栈中删掉。

当函数调用嵌套的层级比较深了，调用栈中的调用帧比较多，这对内存消耗是非常大的。ES6 提供了“尾调用优化”来解决调用帧过多引起的内存消耗过大的问题。

### 什么是尾调用

尾调用指的是：**函数的最后一步是返回调用另一个函数的结果**。

```JavaScript
function f(x){
  return g(x); // 最后一步调用另一个函数并且使用 return
}

function f(x){
  g(x); // 没有 return 不算尾调用，因为不知道后面还有没有操作
  // return undefined; // 隐式的 return
}
```

### 尾调用的作用

尾调用用来**删除外层无用的调用帧**，只保留内层函数的调用帧，来节省浏览器的内存。但是需要注意的是：

1. 只有**内层函数不再用到外层函数的变量**时，外层调用帧才是无用的，内层函数的调用帧才会取代外层函数的调用帧。如果要使用外层函数的变量，可以通过参数的形式传到内层函数中。
2. 尾调用优化只在严格模式下开启，非严格模式是无效的。

```JavaScript
function a(){
    var aa = 1;
    let b = val => aa + val // 使用了外层函数的参数aa
    return b(2) // 无法进行尾调用优化
}
```

当然，如果环境不支持“尾调用优化”，代码还可以正常运行，是无害的！



