> 转摘：[天天用消息队列 MQ，却不知道为啥要用，尴尬不？](https://mp.weixin.qq.com/s/zC2LGdy1DZ2_WE-2lx34ZQ)

## 一、 使用 MQ 的好处

使用消息队列的好处主要有三个：解耦、异步、削峰。

### 1.1 解耦

对于由不同模块组合完成一个功能的需求，传统方式上是直接使用一个模块调用另一个模块的方式。如下图所示：

![](http://cnd.qiniu.lin07ux.cn/markdown/1569549126431.png)

这种方式下，各个模块之间的耦合性很高，当需要修改、替换或者增加被调用模块时，调用方也需要修改代码。

使用消息中间件之后，调用方和被调用方之间通过中间件作为数据传递和沟通渠道，调用方只需要将消息数据存入到中间件，而被调用方通过监听中间件的消息数据变动来自动执行，从而将调用方和被调用方完成解耦，互不干涉。

### 1.2 异步

在传统模式下，当一个模块需要通过另一个模块来完成非必要的任务时，需要同步的等待其调用完成才能返回响应给用户，时间浪费在了等待非必要任务的完成上。如下图所示：

![](http://cnd.qiniu.lin07ux.cn/markdown/1569549465658.png)

而使用消息中间件之后，调用方将数据存入到中间件之后即可立即返回响应，非必要的业务逻辑以异步的方式运行，可以大大减少请求响应时间。如下图所示：

![](http://cnd.qiniu.lin07ux.cn/markdown/1569549549965.png)

### 1.3 削峰

在传统模式下，当并发量比较大的时候，容易造成单点资源(如数据库)无法正常响应，出现异常，从而影响用户的使用。

加入消息中间件之后，可以按照单点资源的最大并发量从中间件中提取消息进行处理，避免出现异常情况。此时，这个短暂的高峰期积压是可以接受的。

## 二、使用消息中间件的缺点

在原本的系统上增加了中间件系统，必然会增加整个系统的复杂性、降低可用性。

### 2.1 增加复杂性

引入消息中间件之后，需要从多个方面确保消息数据的安全，如一致性问题、重复消费问题、消息可靠传输问题、中间件异常时消息数据丢失问题等。

因此，需要考虑的东西更多，系统复杂性增大。

### 2.2 降低可用性

向系统中每新增加一个模块，都会由于该模块也会出现问题而降低整个系统的可用性。

加入消息中间件也一样，需要保证消息中间件的可用性问题，要避免数据在消息中间件丢失，从而降低了整个系统的可用性。

