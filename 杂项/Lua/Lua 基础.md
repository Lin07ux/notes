## 一、Lua 基础

### 1.1 是什么

Lua 是一种功能强大、高效、轻量、可嵌入的脚本语言，用标准 C 语言编写并以源代码形式开放，其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。

Lua 是动态类型语言，通过使用基于寄存器的虚拟机解释字节码运行，并具有增量垃圾收集的自动内存管理，是配置、脚本和快速原型设计的最佳选择。

Lua 具有变量、函数、闭包、注释等脚本语言的基础特性，与其他脚本语言有较大的类似之处，也有一些细节上的区别。

### 1.2 注释

Lua 脚本支持单行注释和多行注释：

* 单行注释使用双横线`--`表示，双横线后的内容为注释内容。
* 多行注释的一种表现是以双横线加双左中括号`--[[`开始，以双右中括号`]]`结束(一般会用`--]]`结束，更美观)。

```lua
-- 这是单行注释

--[[
这是多行注释
可以有多行
--]]
```

## 二、变量

Lua 标示符用于定义一个变量、函数或其他用户定义的项。标示符以一个字母`A`到`Z`或`a`到`z`或下划线`_`开头后加上 0 个或多个字母、下划线、数字(0 到 9)。最好不要使用下划线加大写字母的标示符，因为 Lua 的保留字也是这样的。Lua 不允许使用特殊字符如`@`、`$`和`%`来定义标示符。

Lua 是一个**区分大小写**的编程语言。因此在 Lua 中`Runoob`与`runoob`是两个不同的标示符。

### 2.1 保留字

Lua 中还有一些普通格式的保留字，这些保留字也不可作为变量标识符。

and   | break  | do     | else     | elseif
end   | false  | for    | function | goto
if    | in     | local  | nil      | not
or    | repeat | return | then     | true
until | while

由于 Lua 是大小写敏感的，所以如果这些字符有大写的，则就不是保留字了，比如，`and`是保留字，但`And`和`AND`不是。

### 2.2 全局变量

在默认情况下，变量总是认为是全局的。全局变量不需要声明，给一个变量赋值后即创建了这个全局变量，访问一个没有初始化的全局变量也不会出错，只不过得到的结果是`nil`。

如果想删除一个全局变量，只需要将变量赋值为`nil`即可。

```lua
print(b) -- nil

b = 10
print(b) -- 10

b = nil
print(b) -- nil
```

### 2.3 局部变量

Lua 的变量默认是全局变量，局部变量需要使用`local`关键字显示声明。

局部变量可以避免增加不必要的名称来混淆全局环境，同时也能避免两部分代码的命名冲突。另外，访问局部变量要比访问全局变量的速度更快。

局部变量的使用范围是有限制的，只在它声明的块中可用。块可以是控制结构体或函数体或者是整个文件中。

比如：

```lua
-- test.lua 文件脚本

a = 5               -- 全局变量
local b = 5         -- 局部变量(属于本文件)

function joke()
    c = 5           -- 全局变量
    local d = 6     -- 局部变量(属于该函数)
end

joke()
print(c, d)          --> 5 nil (d 是 joke 函数的局部变量，当前代码块中没有该变量)

do 
    local a = 6     -- 局部变量(属于本代码块)
    b = 6           -- 对文件局部变量重新赋值
    print(a, b);     --> 6 6
end

print(a, b)      --> 5 6 (这里的 a 是全局变量)
```

> 在交互模式下，每次输入都是一块代码，输入`local i = 1`时就定义了一个局部变量`i`，而在下一行使用`i`时它又成了全局变量。为了避免这个问题，需要显式的使用`do-end`标记代码块的范围。

Lua 有一个常见的习语：

```lua
local foo = foo
```

这里定义了一个局部变量`foo`，并把全局变量`foo`的值赋给局部变量。这一习语主要用来提升变量`foo`的访问速度，或者对变量进行暂存，防止其他函数改变这个变量的值。

## 三、赋值

### 3.1 简单赋值

赋值是改变一个变量的值和改变表域的最基本的方法：

```lua
a = "hello" .. "world"
t.n = t.n + 1
```

### 3.2 多变量同时赋值

Lua 可以对多个变量同时赋值，变量列表和值列表的各个元素用逗号分开，赋值语句右边的值会依次赋给左边的变量。比如：

```lua
a, b = 10, 2*x

-- 等同于
a = 10; b = 2*x
```

遇到赋值语句 Lua 会先计算右边所有的值然后再执行赋值操作，所以可以这样进行交换变量的值：

```lua
x, y = y, x                     -- swap 'x' for 'y'
a[i], a[j] = a[j], a[i]         -- swap 'a[i]' for 'a[j]'
```

当变量个数和值的个数不一致时，Lua 会以变量个数为基础采取以下策略：

* 变量个数 > 值的个数：按变量个数补足 nil
* 变量个数 < 值的个数：多余的值会被忽略

比如：

```lua
a, b, c = 0, 1
print(a, b, c)             --> 0   1   nil
 
a, b = a+1, b+1, b+2     -- value of b+2 is ignored
print(a, b)               --> 1   2
 
a, b, c = 0
print(a, b, c)             --> 0   nil   nil

a, b, c = 0, 0, 0
print(a, b, c)             --> 0   0   0
```

多值赋值经常用来交换变量，或将函数调用返回给变量。假如`foo()`方法会返回两个值，那么下面的语句会将第一个返回值赋值给变量`a`，第二个返回值赋值给变量`b`：

```lua
a, b = f()
```

