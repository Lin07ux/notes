计算数字二进制表示中 1 的数量，在数学上被称为计算汉明重量。

### 0. 一般算法

利用定位累加方式，依次获取数值的每一位值，如果结果大于 0 则加 1，否则不增加累加器。最终遍历完数值的每一位之后，累加器的值就是数值中 1 的数量了。

```JavaScript
function hammingWeight (number) {
    let count = 0;
    
    // 假设是 32 位无符号数值
    for (let i = 0; i < 32; i++) {
        count += number & (1 << i);
    }
    
    return count;
}
```

使用这种方式进行遍历，则每次都需要循环数值的二进制位数，无论数值的大小。

### 1. n & (n - 1)

> 参考：[二进制数中 1 的个数](https://real-neo.me/number-of-1-bits.html)

知识点：**`n & (n - 1)`可以消去二进制数的最右边的 1**。

比如，对于数字`n = 189`，其二进制表示为`1011 1101`，那么`n - 1`的值用二进制表示就是`1011 1100`，所以`n & (n - 1)`的结果就是`(1011 1101) & (1011 1100) = 1011 1100`。这和`n`的二进制表示相比，只有最后的一个非 0 位不相同了。也就是说`n & (n - 1)`消去了数值 n 的最后一个 1 位。

使用上面的知识点，将数值位的 1 一个个的消除掉，那么数值就变成 0 了，统计消除操作的次数即可得到该数值的二进制表示中总共有多少个 1 了。

需要注意的地方在于：计算机中，负数一般使用的是相应正数的补码表示。如果要统计一个正数的实际底层二进制表示中有多少个 1，使用上面的方式即可；否则就需要考虑先将数值转成对应的正数表示再进行统计。

JavaScript 代码实现如下：

```JavaScript
function hammingWeight (number) {
    let count = 0;
    
    // 对于数字 -7，加这一步时结果为 7，不加这一步则为 30
    number = Math.abs(number)
    
    while (number) {
        number &= number - 1;
        count++;
    }
    
    return count;
}
```

使用这种方式一般情况下可以比循环判断每个二进制位是否为 1 高效，但是如果二进制位全为 1 的时候，这样与循环判断一样，需要循环数值的位数次了。

### 2. 分治

> 转摘：[LeetCode 每日一题 191. 位1的个数](https://zhuanlan.zhihu.com/p/37623166)

利用分治算法，先将数值的二进制分为两两一组，分别计算每一组的和，然后再将计算的结果再次两两分组，继续计算，最终得到的一组结果即使该数值的汉明重量了。

计算代码如下：

```JavaScript
function hammingWeight (n) {
    n = (n & 0x55555555) + (n >> 1 & 0x55555555);
    n = (n & 0x33333333) + (n >> 2 & 0x33333333);
    n = (n & 0x0f0f0f0f) + (n >> 4 & 0x0f0f0f0f);
    n = (n & 0x00ff00ff) + (n >> 8 & 0x00ff00ff);

    return (n & 0x0000ffff) + (n >> 16 & 0x0000ffff);
}
```

比如，计算数值 211 的汉明重量。211 的二进制表示为`1101 0011`，那么使用分治方式时就是如下的计算过程：

![](http://cnd.qiniu.lin07ux.cn/markdown/1575462403825.png)

* 第一次：把每相邻的两位加起来，得到每两位里 1 的个数，比如前两位的计算结果`10`就表示原数的前两位有 2 个 1。
* 第二次：继续两两相加，`10+01=11`，`00+10=10`，得到的结果是`0011 0010`，它表示原数前 4 位有 3 个 1，末 4 位有 2 个 1。
* 最后一次：把`0011`和`0010`加起来，得到的就是整个二进制中 1 的个数。

程序中巧妙地使用取位和右移，比如第二行中`0x33333333`的二进制为`00110011001100110011001100110011`，用它和 n 做逻辑与运算就相当于以 2 为单位间隔取数。



[](https://www.cnblogs.com/graphics/archive/2010/06/21/1752421.html)

