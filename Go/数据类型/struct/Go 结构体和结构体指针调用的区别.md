> 转摘：[你知道 Go 结构体和结构体指针调用有什么区别吗？](https://mp.weixin.qq.com/s/g-D_eVh-8JaIoRne09bJ3Q)

### 1. 示例

有如下结构体定义：

```go
type MyStruct struct {
  Name strig
}

func (s MyStruct) SetName1(name string) {
  s.Name = name
}

func (s *MyStruct) SetName2(name string) {
  s.Name = name
}
```

结构体`MyStruct`定义了两个方法，分别使用结构体和结构体指针作为接收器。

### 2. 区别

在一个类型上定义一个方法时，接收器（在上面的例子中就是 s）的行为就像它是方法的一个参数一样。

也就是说，上面的两个方法相当于如下的两个函数：

```go
func SetName1(s MyStruct, name string) {
  s.name = name
}

func SetName2(s *MyStruct, name string) {
  s.name = name
}
```

因此，结构体方法是要将接收器定义为值还是指针，本质上与函数参数应该是指还是指针是同一个问题。

### 3. 如何选择

因为 Go 中是按值传递的，所以参数是值还是指针会对程序的结果和效率有不同的影响。

整体考虑，有如下几个考虑因素，按重要程度顺序排列如下：

1. 在使用上的考虑：方法是否需要修改接收器？如果需要，接收器必须是一个指针；

2. 在效率上的考虑：如果接收器很大（比如，一个非常大的结构体），使用指针接收器会好很多，避免了大结构体的复制操作；

3. 在一致性上的考虑：如果类型的某些方法必须有指针接收器，那么其余的方法也应该有指针接收器，所以无论类型如何使用，方法集都是一致的。

回到上面的例子，从功能使用角度来看：

* 如果`SetName2`方法修改了 s 的字段值，调用者是可以看到这些变更的，因为是指针引用，本质上是修改同一份数据；
* 而对`SetName1`方法来说，该方法是用调用者参数的副本来调用的，本质上和原调用者是两份数据，它对结构体字段所做的变更对调用者来说是看不见的。

另外，对于基本类型、切片和小结构体等类型，值接收器是非常廉价的。

因此。除非方法的语义需要指针，那么值接收器是最高效和清晰的。在 GC 方面也不需要过度关注，出现 GC 性能问题时再解决即可。

