> 转摘：[周刊题解：常量表达式这个规则应该了解下](https://mp.weixin.qq.com/s/8fG0OMvwKziMSRs8bZFj2Q)

### 1. 常量类别

Go 语言中的常量可以分为**无类型常量**(untyped constants)和**有类型常量**，也可以分为**字面值常量**和**具名常量**(named constants)。

比如：

```go
const a = 1 + 2 // a == 3 是无类型常量
const b int8 = 1 + 2 // b == 3 是有类型
```

这个代码中，`a`没有指定类别，所以是无类型常量，`b`被指定了类型`int8`，所以是有类型常量。同时，`a`和`b`又会被称为具名变量，而代码中的 1 和 2 这样的就是字面值常量。

无类型常量也叫做类型不确定常量，有类型常量也叫做类型确定常量。虽然无类型常量的类型不确定，但是对于大多数类型不确定字面量来说，它们都有一个默认类型，除了预声明的`nil`(`nil`是没有默认类型的)：

* 一个字符串字面量的默认类型是 string；
* 一个布尔字面量的默认类型是 bool；
* 一个整形数字面量的默认类型是 int；
* 一个 rune 字面量的默认类型是 rune(也就是 int32)；
* 一个浮点数字面量的默认类型是 float64；
* 如果一个字面量含有虚部字面量，则此字面量的默认类型是 complex128。

### 2. 类型推导

Go 能自动进行类型推导，因此，在一些场景下，可以使用类型不确定值，由 Go 编译器自动推导出这些值在特定场景下的类型。

如果根据上下文，不能确定类型，则编译器会将这些不确定类型的值视为它们的默认类型。这是 Go 能支持的隐式类型转换。

除了上述的情况，Go 是不支持其他隐式类型转换的，必须要进行显式类型转换。

### 3. 常量表达式

常量表达式是指仅包含常量操作数、且是在编译的时候进行计算的表达式。

在 Go 语言规范中提到，**任何在无类型常量上的操作结果是同一个类型的无类型常量**，也就是： 布尔、整数、浮点数、复数、rune 或者字符串常量。

如果一个二元运算符（非移位）的无类型操作数是不同的，那么其结果是操作数的类型出现在下面列表靠后位置的类型：

1. 整数
2. rune
3. 浮点数
4. 复数

比如，对于下面的代码：

```go
package main

import "fmt"

func main() {
    var ans float64 = 15 + 25 + 5.2
    fmt.Println(ans)
}
```

可选答案如下：

A. 不能编译
B. 45
C. 45.2
D. 45.0

正确答案是 C。因为表达式中`15 + 25 + 5.2`的操作数都是无类型的字面值常量，但是有个`5.2`操作数，它的默认类型是浮点型。所以这个表达式常量的结果虽然是无类型的，但是默认类型是浮点型。

