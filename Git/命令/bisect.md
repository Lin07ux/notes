> 转摘：[git bisect 命令教程](http://www.ruanyifeng.com/blog/2018/12/git-bisect.html)

`git bisect`主要用于分析代码，查找是从哪一个提交中引入了相关特性或 bug 等。原理很简单，就是将代码提交的历史，按照两分法不断缩小定位。所谓"两分法"，就是将代码历史一分为二，确定问题出在前半部分，还是后半部分，不断执行这个过程，直到范围缩小到某一次代码提交。

假如有一个仓库，有很多个提交，但是不知道在哪个提交中引入了一个错误，需要对其进行分析查找。

### 1. 查看提交历史

查看仓库提交历史，找到最早一次提交(或确定没有该错误的提交)：

```shell
git log --pretty=oneline
```

### 2. 启动查找

确定好起始提交和最后一次提交的 commit hash 之后就可以启动查找流程了(假如起始提交为`4d83cf`)：

```shell
git bisect start HEAD 4d83cf
```

其中，`git bisect start`命令的第一个参数表示终点，在这里也就是`HEAD`，最后一个提交；第二个参数表示起点，也就是从这里可能会引入了错误。

执行上面的命令以后，代码库就会切换到这段范围正当中的那一次提交。然后检查此时代码是否正常，是否有该错误。根据是否有该错误，执行后续的第 3 或第 4 步。

### 3. 标记为 good

如果当前代码是正常的，没有问题，那么可以使用下面的命令告诉 Git 当前是好的：

```shell
git bisect good
```

当将当前代码标记为正常后，就意味着错误是在该提交的后半段引入的。然后 Git 就自动切换到后半段的中点，让用户再次判断是否正常。

> 相当于，Git 会将当前提交设置为起点，之前的终点为终点，再次执行`git bisect start`。

### 4. 标记为 bad

如果当前代码已经出现了要查找的问题，那么可以使用下面的命令将其标记为有问题：

```shell
git bisect bad
```

当将当前代码标记为有问题后，就意味着错误是在当前提交和前一个标注点之间引入的，然后 Git 就自动切换到这两次提交的中点。

> 相当于，Git 会将当前提交设置为终点，之前的`git bisect`的起点为起点，再次执行`git bisect start`。

### 5. 找到结果

一直重复执行前面的第 3 和第 4 步，直到剩下一个提交，表明错误就是在这个提交中引入的。这时，Git 会给出类似如下的提示：

```
b47892 is the first bad commit
```

找到错误引入的地方之后，就可以对其进行检查，确定问题的原因了。

然后就可以结束当前查找了：

```shell
git bisect reset
```

此时，会退出查错，回到最近一次的代码提交，然后就可以进行问题修复等工作了。


